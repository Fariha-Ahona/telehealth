{% extends "base.html" %}

{% block title %}
Doctor Dashboard
{% endblock %}

{% block content %}

<div class="bg-gradient-to-br from-[#dfe2ff] via-[#cbc1fa] to-[#a7c0f9] min-h-screen py-10">
  <div class="max-w-7xl mx-auto px-6 grid grid-cols-1 lg:grid-cols-3 gap-10">

    <!-- LEFT COLUMN -->
    <div class="flex flex-col gap-7">

      <!-- Doctor Info -->
      <div class="bg-white rounded-lg p-6 shadow-lg flex items-center gap-5">
        <img
          src="https://randomuser.me/api/portraits/women/45.jpg"
          class="w-16 h-16 rounded-full border-2 border-violet-300"
        />
        <div>
          <h2 class="font-bold text-violet-800 text-2xl">
            Dr. {{ request.user.username }}
          </h2>
          <p class="text-indigo-600 text-sm">
            Manage your appointments & consultations
          </p>
        </div>
      </div>

      <!-- Slots -->
      <div class="bg-white rounded-lg p-6 shadow">
        <h3 class="font-bold text-violet-700 mb-2">Slots</h3>
        <p class="text-indigo-600 text-sm mb-2">Manage your availability</p>
        <a
          href="{% url 'doctor_slots' %}"
          class="text-violet-700 font-semibold underline hover:text-pink-600"
        >
          View / Edit Slots
        </a>
      </div>

      <!-- Profile -->
      <div class="bg-white rounded-lg p-6 shadow">
        <h3 class="font-bold text-violet-700 mb-2">Profile</h3>
        <p class="text-indigo-700 text-sm">
          <strong>Name:</strong> Dr. {{ request.user.username }} <br />
          <strong>Email:</strong> {{ request.user.email }}
        </p>
      </div>

    </div>

    <!-- RIGHT COLUMN -->
    <div class="col-span-2 flex flex-col gap-7">

      <!-- Appointment Requests -->
      <div class="bg-white rounded-lg p-7 shadow">
        <h2 class="text-xl font-bold text-indigo-800 mb-4">
          Appointment Requests
        </h2>

        {% if appointments %}
        <table class="w-full text-sm">
          <thead>
            <tr class="border-b font-semibold text-left">
              <th>Patient</th>
              <th>Date</th>
              <th>Time</th>
              <th>Action</th>
            </tr>
          </thead>

          <tbody class="my-4">
            {% for a in appointments %}
            <tr class="border-b">
              <td class="py-4">{{ a.patient.username }}</td>
              <td>{{ a.slot.date }}</td>
              <td>{{ a.slot.start_time }} â€“ {{ a.slot.end_time }}</td>

              <td class="space-x-2">

                <!-- PENDING -->
                {% if a.status == "PENDING" %}
                  <a href="{% url 'approve_appointment' a.id %}"
                     class="px-3 py-1 bg-green-500 text-white rounded text-xs">
                    Approve
                  </a>

                  <a href="{% url 'reject_appointment' a.id %}"
                     class="px-3 py-1 bg-red-500 text-white rounded text-xs">
                    Reject
                  </a>

                <!-- APPROVED but NOT STARTED -->
                {% elif a.status == "APPROVED" and a.consultation_status == "NOT_STARTED" %}
                  <span class="text-green-700 font-semibold text-sm mr-2">
                    Approved
                  </span>

                  <a href="{% url 'start_consultation' a.id %}"
                     class="px-3 py-1 bg-indigo-600 text-white rounded text-xs">
                    Start Consultation
                  </a>

                <!-- ONGOING -->
                {% elif a.consultation_status == "ONGOING" %}
                  <a
                    href="{{ a.zoom_start_url }}"
                    target="_blank"
                    class="px-3 py-1 bg-indigo-600 text-white rounded text-xs">
                    Open Zoom
                  </a>

                <!-- COMPLETED -->
                {% elif a.consultation_status == "COMPLETED" %}
                  <span class="text-gray-600 text-sm mr-2">
                    Completed
                  </span>

                  {% if a.prescription_pdf %}
                    <a
                      href="{{ a.prescription_pdf.url }}"
                      target="_blank"
                      class="px-3 py-1 bg-violet-600 text-white rounded text-xs">
                      View Prescription
                    </a>
                  {% endif %}

                {% endif %}

              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>

        {% else %}
          <p class="text-indigo-600 text-sm">No appointment requests yet.</p>
        {% endif %}
      </div>

      <!-- Notifications -->
      <div class="bg-white rounded-lg p-6 shadow">
        <h3 class="font-bold text-violet-700 mb-2">Notifications</h3>
        <p class="text-indigo-600 text-sm">
          System notifications will appear here
        </p>
      </div>

    </div>
  </div>
</div>

{% endblock %}
